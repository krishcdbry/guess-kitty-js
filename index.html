<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/style.css">

	<script src="build/react.js"></script>
	<script src="build/react-dom.js"></script>
	<script src="https://unpkg.com/babel-core@5.8.38/browser.min.js"></script>
	<title>guess kitty</title>
</head>
<body class="loading">
<div id="header"></div>
<div id="root"></div>
<a href="https://github.com/krishcdbry/guess-kitty-react" style="position: fixed; bottom: 20px; right: 20px; z-index: 999999; opacity: 0.3; font-size: 12px; color: #000; text-decoration: none;">
	view on github â†’
</a>

<script type="text/babel">
	// Remove loading class after DOM ready
	setTimeout(() => document.body.classList.remove('loading'), 100);
	class WholeKitty extends React.Component {
		render() {
			return (
				<div className="App-header">
					<h1>guess kitty</h1>
				</div>
			)
		}
	}

	class GuessKitty extends React.Component {

		constructor(props) {
			super(props)

			var scores = [];

			if (localStorage.getItem('scores')) {
				scores = localStorage.getItem('scores').split(',');
				scores = scores.map(function(item) {
					return parseInt(item, 10);
				});
				this.calculateScoreSummary(scores);
			}

			this.state = {
				NUMBER_OF_BLOCKS: 25
				, blocks: []
				, KITTY_INDEX: Math.floor((Math.random() * 25))
				, win : false
				, attempts: 0
				, currentScore: 0
				, scores : scores
				, startGame: false
			};

			for (var i = 0; i < this.state.NUMBER_OF_BLOCKS; i++) {
				var content = (i === this.state.KITTY_INDEX) ? 'KITTY' : 'X';
				this.state.blocks.push(content);
			}
		}

		createConfetti() {
			// Subtle Metro confetti
			const confettiCount = 12;

			for (let i = 0; i < confettiCount; i++) {
				const confetti = document.createElement('div');
				confetti.style.position = 'fixed';
				confetti.style.width = '1px';
				confetti.style.height = '1px';
				confetti.style.backgroundColor = '#000';
				confetti.style.left = Math.random() * 100 + '%';
				confetti.style.top = '-10px';
				confetti.style.opacity = '0.2';
				confetti.style.zIndex = '999999';
				confetti.style.pointerEvents = 'none';

				document.body.appendChild(confetti);

				const duration = Math.random() * 1.5 + 1.5;

				confetti.animate([
					{ transform: 'translateY(0)', opacity: 0.2 },
					{ transform: `translateY(${window.innerHeight + 20}px)`, opacity: 0 }
				], {
					duration: duration * 1000,
					easing: 'linear'
				});

				setTimeout(() => {
					confetti.remove();
				}, duration * 1000);
			}
		}

		calculateScoreSummary(scores) {
			if (scores.length < 1) {
				return;
			}
			this.totalScore = scores.reduce(function(next, prev) {
				return Number(next) + Number(prev);
			});

			this.avgScore = Math.round(this.totalScore / scores.length);
			this.minScore = scores.reduce(function(a,b) { return (a < b) ? a : b });
			this.maxScore = scores.reduce(function(a,b) { return (a > b) ? a : b });
		}

		getScoreUpdate() {
			var scores = this.state.scores;
			this.calculateScoreSummary(scores);
		}

		handleClick(index) {
			var blocks =  this.state.blocks;
			var scores = this.state.scores;
			if (this.state.blocks[index] !== 'VISITED') {
				blocks[index] = 'VISITED';
				if (index === this.state.KITTY_INDEX) {
					var currentScore = (25-this.state.attempts)*100;
					scores.push(currentScore);
					// Trigger confetti on win!
					setTimeout(() => this.createConfetti(), 300);
				}
				this.state.attempts++;
				this.setState({
					blocks: blocks
					, attempts: this.state.attempts
					, win: (index === this.state.KITTY_INDEX)
					, currentScore : currentScore
					, scores: scores
				});

				localStorage.setItem('scores', scores);
				this.getScoreUpdate();
			}

		}

		handleClickRestart() {
			var state = this.state;
			state.NUMBER_OF_BLOCKS =  25;
			state.blocks = [];
			state.KITTY_INDEX = Math.floor((Math.random() * 25));
			state.win = false;
			state.attempts = 0;
			state.currentScore = 0;

			for (var i = 0; i < state.NUMBER_OF_BLOCKS; i++) {
				var content = (i === state.KITTY_INDEX) ? 'KITTY' : 'X';
				state.blocks.push(content);
			}

			this.setState(state);
		}

		clearScores() {
			this.setState({
				scores: []
			});

			localStorage.clear();
			this.getScoreUpdate();
		}

		startGame() {
			this.setState({
				startGame: true
			})
		}

		render() {
			return (
				<div className="App">
					<div className="game-area">
						<div className={"board " + (this.state.win ? "board won": "")}>
							{this.state.blocks.map((block, index) => {
								return  (block === 'VISITED')
									? (index === this.state.KITTY_INDEX)
									? <div onClick={() => this.handleClick(index)} className="block success"><i className="fa fa-smile-o"></i></div>
									: <div onClick={() => this.handleClick(index)} className="block failed"><i className="fa fa-frown-o"></i></div>
									: <div onClick={() => this.handleClick(index)} className="block"><span className="fa fa-lock"></span></div>;
							})}
						</div>
						<div className={"score " + (this.state.win ? "Winner-anim": "")}>
							<p>score</p>
							<h3>{this.state.currentScore}</h3>
							<br></br>
							<a href="javascript:;" onClick={() => this.handleClickRestart()} className="noDecoration"><span>play again</span></a>
						</div>
						<h3>{this.state.attempts} / 25</h3>
						<div className={this.state.scores.length > 0 ? "scores": "scores hide-me"}>
							<h3>performance</h3>
							<div className="score-list">
								{this.state.scores.map((score, index) => {
									return <p><b>{String(index+1).padStart(2, '0')}</b> <span>{score}</span></p>
								})}
							</div>
							<div className="score-summary">
								<div className="score-summary-block">
									sum <span>{this.totalScore}</span>
								</div>
								<div className="score-summary-block">
									avg <span>{this.avgScore}</span>
								</div>
								<div className="score-summary-block">
									max <span>{this.maxScore}</span>
								</div>
								<div className="score-summary-block">
									min <span>{this.minScore}</span>
								</div>
							</div>
							<p>
								<a href="javascript:;" onClick={() => this.clearScores()} className="clear-scores">reset</a>
							</p>
						</div>
					</div>
					<div className={this.state.startGame || this.state.scores.length > 0 ? "wrapper hide-me" : "wrapper"}>
						<div className="wrapper-content">
							<center>
								<div className="wrapper-title">
									guess kitty
								</div>
								<p>
									a puzzle game where intuition meets strategy. find the hidden element within the grid while minimizing your attempts to maximize your score.
								</p>
								<div className="intro-data" onClick={() => this.startGame()} >
									<img src="assets/img/guess-kitty-one.png" className="screenshots" alt="interface"/>
									<img src="assets/img/guess-kitty-two.png" className="screenshots" alt="progress"/>
									<img src="assets/img/guess-kitty-three.png" className="screenshots" alt="result"/>
								</div>
								<a href="javascript:;" onClick={() => this.startGame()} className="start-game">
									<span>start game</span> <i className="fa fa-arrow-right start-button"></i>
								</a>
							</center>
						</div>
					</div>
				</div>
			);
		}
	}

	ReactDOM.render(
		<WholeKitty/>,
		document.getElementById('header')
	);

	ReactDOM.render(
		<GuessKitty/>,
		document.getElementById('root')
	);


</script>
</body>
</html>
